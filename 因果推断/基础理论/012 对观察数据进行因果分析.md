# 对观察数据进行因果分析
## **1. 为什么观察数据难做因果分析？**

因为：

- 人不是随机分组
- 存在混杂变量（confounders）
- 存在内生性
- 可能有自我选择、自我筛选
- 反向因果（endogeneity）

比如：

> 看到锻炼的人更健康，但其实可能是因为健康的人更爱锻炼。

所以：

> **相关 ≠ 因果**

著名的有辛普森悖论和伯克森悖论，见[[020 干预和潜在结果]]

---

## **2. 因果推断的核心逻辑：反事实框架**

现代因果推断都建立在 **反事实（counterfactual）** 思想上。

- 每个人都有两个潜在结果：
    - Y(1)Y(1)：接受处理时的结果
    - Y(0)Y(0)：不接受处理时的结果

因果效应（treatment effect）：

$\text{TE}_i = Y_i(1) - Y_i(0)$

但问题是：

- 我只能看到其中一个结果（“现实”）
- 看不到另一个结果（“反事实”）

因此，所有因果分析方法都在试图：

> 用 **可观测的数据** 去推断 **不可观测的反事实**。

---

## **3. 观察数据因果分析的方法**

下面是常见、最经典的方法：

---

### **1. 回归分析 + 控制变量**

最简单的思路：

$Y_i = \beta_0 + \beta_1 T_i + \gamma X_i + \varepsilon_i$

其中：

- $T_i$：处理变量
- $X_i$：控制变量

只要能控制所有混杂变量，$\beta_1$ 就是因果效应。

但问题：

- 如果遗漏了重要变量 → 内生性仍然存在。

---

### **2. 工具变量法（IV）**

如果：

- TT 内生（与误差相关）

则需要一个工具变量 ZZ：

- 与 TT 强相关
- 与 YY 无关，且不直接影响 YY

经典方法：

- 两阶段最小二乘（2SLS）

例：

- 用距离健身房远近，作为锻炼的工具变量 → 估计锻炼对健康的因果效应。

---

### **3. 双重差分法（DID）**

如果有政策冲击或外部事件：

- 比较处理组 vs. 对照组，在事件前后的变化

$\text{DID} = \big( Y_{T, post} - Y_{T, pre} \big) - \big( Y_{C, post} - Y_{C, pre} \big)$

要求：

- 趋势平行假设（parallel trends）

---

### **4. 匹配方法（Matching）**

通过匹配，使处理组和对照组在观测变量上“相似”。

常用：

- 倾向得分匹配（Propensity Score Matching, PSM）
- 最近邻匹配
- 半径匹配

核心思想：

- 用观测数据去“模拟”随机实验。

局限：

- 无法控制未观测混杂变量。

---

### **5. 回归断点设计（RD Design）**

如果处理是由某个分数阈值决定：

- 比如成绩 > 60 分才进实验班

则可以比较阈值两边的人：

- 越接近阈值，两组人越相似。

---

### **6. 控制函数法（Control Function）**

适用于非线性模型：

- 比如 Probit、Tobit

先建模内生变量，再把残差放进主回归。

---

### **7. 结构方程模型（SEM）**

用路径分析和结构方程同时处理：

- 多重因果链
- 潜变量

---

### **8. Causal Graphs / DAGs**

Pearl 的因果图：

- 用图形化方式表示变量之间的因果路径
- 判断哪些变量需要控制

比如：

- Backdoor Criterion → 解决混杂

---

### **9. G-Computation / g-formula**

用于处理时间依赖的因果关系：

- 尤其在流行病学非常常用

---

### **10. Machine Learning 与因果推断结合**

最近几年很火：

- Causal Forest
- Double Machine Learning
- Bayesian Additive Regression Trees (BART)

它们通过灵活拟合复杂关系，减少模型设定偏误。

---

## **4. 分析流程**

做观察数据因果推断，大致流程：

✅ 明确研究问题  
→ 因果问题还是预测问题？

✅ 绘制因果图  
→ 明确潜在混杂、反向因果

✅ 判断数据类型  
→ 横截面、面板、断点？

✅ 选择方法  
→ IV、DID、RD、匹配？

✅ 检验稳健性  
→ 平行趋势检验、工具变量检验

✅ 报告结果  
→ 报告假设、限制条件、外部效度

---

## ⭐ 小例子

比如你研究：

> **锻炼对健康的因果影响**

- OLS 回归 → 加控制变量（年龄、收入、基线健康）
- 匹配 → 匹配生活方式相似的人
- DID → 若城市出台健身补贴政策
- IV → 用距离健身房远近做工具变量
- RD → 若健身补贴有收入门槛
- DAG → 绘制混杂路径

这就是观察数据因果推断的多种武器库。

---

## **5. 局限**

- 无法完全消除未观测混杂
- 假设较强（如平行趋势、工具变量外生性）
- 结果解释常有限于特定群体（外部效度问题）

---

# ✨ 小结

|方法|核心用途|
|---|---|
|回归 + 控制变量|控制观测混杂|
|工具变量（IV）|解决内生性、反向因果|
|双重差分（DID）|政策冲击、面板数据|
|匹配|减少观测混杂|
|回归断点（RD）|自然分组、阈值设计|
|因果图 / DAG|确定需要控制哪些变量|
|结构方程模型（SEM）|同时建模多条因果链|
|Causal ML|灵活拟合复杂因果效应|
